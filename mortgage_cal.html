<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Australian Home Mortgage Calculator with Offset Account</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .input-section,
        .results-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.95em;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
            -webkit-tap-highlight-color: transparent;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .summary-card h3 {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .summary-card .value {
            font-size: 1.6em;
            color: #667eea;
            font-weight: 700;
            word-break: break-word;
            line-height: 1.2;
        }

        .summary-card.green .value {
            color: #10b981;
        }

        .summary-card.red .value {
            color: #ef4444;
        }

        .summary-card.orange .value {
            color: #f59e0b;
        }

        .summary-card.purple .value {
            color: #8b5cf6;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            max-height: 600px;
            overflow-y: auto;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        thead {
            background: #667eea;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th,
        td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9em;
        }

        th:first-child,
        td:first-child {
            text-align: left;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .highlight-row {
            background: #fef3c7 !important;
            font-weight: 600;
        }

        .breakeven-row {
            background: #d1fae5 !important;
            font-weight: 700;
            border-left: 4px solid #10b981;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            color: #667eea;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
            text-align: center;
            -webkit-tap-highlight-color: transparent;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab:hover {
            background: #e0e7ff;
        }

        .tab.active:hover {
            background: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .info-box {
            background: #e0e7ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .info-box p {
            color: #4338ca;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 8px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.4em;
                line-height: 1.3;
            }

            .header p {
                font-size: 0.9em;
            }

            .content {
                padding: 12px;
                gap: 12px;
            }

            .input-section,
            .results-section {
                padding: 15px;
            }

            .section-title {
                font-size: 1.2em;
            }

            .summary-cards {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .summary-card {
                padding: 15px;
            }

            .summary-card .value {
                font-size: 1.4em;
            }

            .summary-card h3 {
                font-size: 0.8em;
            }

            .tabs {
                gap: 5px;
            }

            .tab {
                padding: 10px 12px;
                font-size: 0.85em;
                min-width: 90px;
            }

            th,
            td {
                padding: 8px 6px;
                font-size: 0.75em;
            }

            .calculate-btn {
                font-size: 1em;
                padding: 14px;
            }

            .input-group {
                margin-bottom: 15px;
            }

            .input-group label {
                font-size: 0.9em;
            }

            .input-group input,
            .input-group select {
                padding: 12px;
                font-size: 16px;
            }

            .table-container {
                max-height: 450px;
            }

            .info-box {
                padding: 12px;
            }

            .info-box p {
                font-size: 0.85em;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .container {
                border-radius: 10px;
            }

            .header {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 1.25em;
                line-height: 1.3;
            }

            .header p {
                font-size: 0.85em;
                line-height: 1.4;
            }

            .content {
                padding: 10px;
                gap: 10px;
            }

            .input-section,
            .results-section {
                padding: 12px;
            }

            .section-title {
                font-size: 1.1em;
                margin-bottom: 15px;
            }

            .summary-card {
                padding: 12px;
            }

            .summary-card .value {
                font-size: 1.3em;
            }

            .summary-card h3 {
                font-size: 0.75em;
            }

            .tab {
                padding: 8px 10px;
                font-size: 0.8em;
                min-width: 80px;
            }

            th,
            td {
                padding: 6px 4px;
                font-size: 0.7em;
            }

            .table-container {
                max-height: 350px;
            }

            table {
                min-width: 480px;
            }

            .calculate-btn {
                padding: 12px;
                font-size: 0.95em;
            }

            .input-group {
                margin-bottom: 12px;
            }

            .input-group input,
            .input-group select {
                padding: 10px;
            }
        }

        /* Extra small devices (very small phones) */
        @media (max-width: 375px) {
            .header h1 {
                font-size: 1.15em;
            }

            .summary-card .value {
                font-size: 1.2em;
            }

            .tab {
                font-size: 0.75em;
                padding: 8px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üè† Australian Home Mortgage Calculator</h1>
            <p>Calculate your mortgage with offset account and salary crediting strategy</p>
        </div>
        <div class="content">
            <!-- Input Section -->
            <div class="input-section">
                <h2 class="section-title">Loan Details</h2>
                <div class="input-group">
                    <label>Loan Amount ($)</label>
                    <input type="number" id="loanAmount" value="500000" step="1000">
                </div>
                <div class="input-group">
                    <label>Interest Rate (% p.a.)</label>
                    <input type="number" id="interestRate" value="5.4" step="0.01">
                </div>
                <div class="input-group">
                    <label>Loan Term (years)</label>
                    <input type="number" id="loanTerm" value="30" step="1">
                </div>
                <div class="input-group">
                    <label>Loan Payment Frequency</label>
                    <select id="paymentFrequency">
                        <option value="monthly" selected>Monthly</option>
                        <option value="fortnightly">Fortnightly</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>EMI Payment Date (day of month)</label>
                    <input type="number" id="emiDate" value="15" min="1" max="28">
                </div>
                <h2 class="section-title" style="margin-top: 30px;">Income Details</h2>
                <div class="input-group">
                    <label>Your Salary (fortnightly, every Thursday) ($)</label>
                    <input type="number" id="salary1" value="3500" step="100">
                </div>
                <div class="input-group">
                    <label>Wife's Salary (monthly, 14th of month) ($)</label>
                    <input type="number" id="salary2" value="7000" step="100">
                </div>
                <h2 class="section-title" style="margin-top: 30px;">Expenses</h2>
                <div class="input-group">
                    <label>Monthly Credit Card Expenses ($)</label>
                    <input type="number" id="ccExpenses" value="4000" step="100">
                </div>
                <div class="input-group">
                    <label>Credit Card Payment Date (day of month)</label>
                    <input type="number" id="ccPaymentDate" value="15" min="1" max="28">
                </div>
                <div class="input-group">
                    <label>Initial Offset Account Balance ($)</label>
                    <input type="number" id="initialOffset" value="0" step="1000">
                </div>
                <button class="calculate-btn" onclick="calculate()">Calculate Mortgage</button>
                <div class="info-box" style="margin-top: 20px;">
                    <p><strong>How it works:</strong></p>
                    <p>‚Ä¢ All salaries credit to offset account</p>
                    <p>‚Ä¢ Interest calculated daily on (Loan - Offset balance)</p>
                    <p>‚Ä¢ CC expenses paid monthly from offset</p>
                    <p>‚Ä¢ EMI deducted from offset account</p>
                </div>
            </div>
            <!-- Results Section -->
            <div class="results-section">
                <h2 class="section-title">Summary</h2>
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3>Total Interest Paid</h3>
                        <div class="value red" id="totalInterest">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3>Total Amount Paid</h3>
                        <div class="value" id="totalPaid">$0</div>
                    </div>
                    <div class="summary-card green">
                        <h3>Interest Saved (vs no offset)</h3>
                        <div class="value" id="interestSaved">$0</div>
                    </div>
                    <div class="summary-card orange">
                        <h3>Time Saved</h3>
                        <div class="value" id="timeSaved">0 months</div>
                    </div>
                    <div class="summary-card purple">
                        <h3>Total Repayment Time</h3>
                        <div class="value" id="totalTime">0 years</div>
                    </div>
                    <div class="summary-card">
                        <h3>Regular EMI Amount</h3>
                        <div class="value" id="emiAmount">$0</div>
                    </div>
                    <div class="summary-card green">
                        <h3>Breakeven Time</h3>
                        <div class="value" id="breakevenTime">-</div>
                    </div>
                    <div class="summary-card green">
                        <h3>Final Offset Balance</h3>
                        <div class="value" id="finalOffset">$0</div>
                    </div>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(event, 'monthly')">Monthly View</div>
                    <div class="tab" onclick="showTab(event, 'fortnightly')">Fortnightly View</div>
                    <div class="tab" onclick="showTab(event, 'yearly')">Yearly View</div>
                </div>
                <div id="monthly" class="tab-content active">
                    <div class="table-container">
                        <table id="monthlyTable">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Loan Balance</th>
                                    <th>Offset Balance</th>
                                    <th>Interest Charged</th>
                                    <th>Principal Paid</th>
                                </tr>
                            </thead>
                            <tbody id="monthlyTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="fortnightly" class="tab-content">
                    <div class="table-container">
                        <table id="fortnightlyTable">
                            <thead>
                                <tr>
                                    <th>Fortnight</th>
                                    <th>Loan Balance</th>
                                    <th>Offset Balance</th>
                                    <th>Interest Charged</th>
                                    <th>Principal Paid</th>
                                </tr>
                            </thead>
                            <tbody id="fortnightlyTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="yearly" class="tab-content">
                    <div class="table-container">
                        <table id="yearlyTable">
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Loan Balance</th>
                                    <th>Offset Balance</th>
                                    <th>Interest Paid</th>
                                    <th>Principal Paid</th>
                                    <th>Total Paid Till Now</th>
                                </tr>
                            </thead>
                            <tbody id="yearlyTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function showTab(event, tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function formatCurrency(amount) {
            return '$' + Math.abs(amount).toLocaleString('en-AU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function formatDate(date) {
            return date.toLocaleDateString('en-AU', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function getNextThursday(date) {
            const result = new Date(date);
            const dayOfWeek = result.getDay();
            const daysUntilThursday = (4 - dayOfWeek + 7) % 7;
            result.setDate(result.getDate() + (daysUntilThursday === 0 ? 7 : daysUntilThursday));
            return result;
        }

        function calculateMonthsDifference(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);

            let years = end.getFullYear() - start.getFullYear();
            let months = end.getMonth() - start.getMonth();
            let days = end.getDate() - start.getDate();

            if (days < 0) {
                months--;
                const prevMonth = new Date(end.getFullYear(), end.getMonth(), 0);
                days += prevMonth.getDate();
            }

            if (months < 0) {
                years--;
                months += 12;
            }

            const totalMonths = years * 12 + months + (days / 30);
            return totalMonths;
        }

        function formatTimePeriod(months) {
            if (months < 1) {
                return Math.round(months * 30) + ' days';
            }

            const years = Math.floor(months / 12);
            const remainingMonths = Math.round(months % 12);

            if (years === 0) {
                return remainingMonths + (remainingMonths === 1 ? ' month' : ' months');
            } else if (remainingMonths === 0) {
                return years + (years === 1 ? ' year' : ' years');
            } else {
                return years + 'y ' + remainingMonths + 'm';
            }
        }

        function calculate() {
            // Get input values
            const loanAmount = parseFloat(document.getElementById('loanAmount').value);
            const annualRate = parseFloat(document.getElementById('interestRate').value) / 100;
            const loanTermYears = parseInt(document.getElementById('loanTerm').value);
            const paymentFrequency = document.getElementById('paymentFrequency').value;
            const emiDate = parseInt(document.getElementById('emiDate').value);
            const salary1Fortnight = parseFloat(document.getElementById('salary1').value);
            const salary2Monthly = parseFloat(document.getElementById('salary2').value);
            const ccExpenses = parseFloat(document.getElementById('ccExpenses').value);
            const ccPaymentDate = parseInt(document.getElementById('ccPaymentDate').value);
            let offsetBalance = parseFloat(document.getElementById('initialOffset').value);

            // Validation
            if (isNaN(loanAmount) || loanAmount <= 0) {
                alert('Please enter a valid loan amount');
                return;
            }
            if (isNaN(annualRate) || annualRate < 0 || annualRate > 30) {
                alert('Please enter a valid interest rate (0-30%)');
                return;
            }
            if (isNaN(loanTermYears) || loanTermYears <= 0 || loanTermYears > 40) {
                alert('Please enter a valid loan term (1-40 years)');
                return;
            }
            if (emiDate < 1 || emiDate > 28) {
                alert('EMI date must be between 1 and 28');
                return;
            }

            // Calculate daily interest rate
            const dailyRate = annualRate / 365;

            // Calculate EMI (monthly)
            const monthlyRate = annualRate / 12;
            const numPayments = loanTermYears * 12;
            const emi = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) /
                (Math.pow(1 + monthlyRate, numPayments) - 1);

            // Calculate without offset (for comparison)
            const totalInterestWithoutOffset = (emi * numPayments) - loanAmount;

            // Initialize tracking variables
            let loanBalance = loanAmount;
            let totalInterestPaid = 0;
            let totalPrincipalPaid = 0;
            const startDate = new Date('2026-01-01');
            let currentDate = new Date(startDate);
            const endDate = new Date(currentDate);
            endDate.setFullYear(endDate.getFullYear() + loanTermYears + 5); // Add extra buffer

            // Data storage
            const dailyData = [];
            const monthlyData = [];
            const fortnightlyData = [];
            const yearlyData = [];

            let monthlyInterest = 0;
            let monthlyPrincipal = 0;
            let fortnightlyInterest = 0;
            let fortnightlyPrincipal = 0;
            let yearlyInterest = 0;
            let yearlyPrincipal = 0;
            let currentMonth = currentDate.getMonth();
            let currentYear = currentDate.getFullYear();
            let fortnightCount = 0;
            let nextThursday = getNextThursday(new Date(startDate));
            let monthlyInterestAccrued = 0; // Interest accrued since last payment
            let breakevenDate = null; // Track when offset >= loan
            let breakevenReached = false;

            // Simulation loop
            let iterationCount = 0;
            const maxIterations = 365 * 40; // Safety limit

            while (loanBalance > 0.01 && currentDate <= endDate && iterationCount < maxIterations) {
                iterationCount++;

                const dayOfMonth = currentDate.getDate();
                const month = currentDate.getMonth();
                const year = currentDate.getFullYear();
                const dayOfWeek = currentDate.getDay();

                // Credit salary 1 (fortnightly on Thursday)
                if (currentDate.getTime() === nextThursday.getTime()) {
                    offsetBalance += salary1Fortnight;
                    nextThursday = new Date(nextThursday);
                    nextThursday.setDate(nextThursday.getDate() + 14);
                }

                // Credit salary 2 (monthly on 14th)
                if (dayOfMonth === 14) {
                    offsetBalance += salary2Monthly;
                }

                // Pay credit card bill
                if (dayOfMonth === ccPaymentDate) {
                    offsetBalance -= ccExpenses;
                }

                // Calculate daily interest on effective balance
                const effectiveBalance = Math.max(0, loanBalance - offsetBalance);
                const dailyInterest = effectiveBalance * dailyRate;

                // Accrue interest
                monthlyInterestAccrued += dailyInterest;
                totalInterestPaid += dailyInterest;
                monthlyInterest += dailyInterest;
                fortnightlyInterest += dailyInterest;
                yearlyInterest += dailyInterest;

                // Pay EMI on EMI date
                if (dayOfMonth === emiDate && loanBalance > 0) {
                    // Add accrued interest to loan balance
                    loanBalance += monthlyInterestAccrued;

                    // Make payment
                    const paymentAmount = Math.min(emi, loanBalance);
                    loanBalance -= paymentAmount;
                    offsetBalance -= paymentAmount;

                    // Principal paid is payment minus interest
                    const principalPaid = paymentAmount - monthlyInterestAccrued;

                    if (principalPaid > 0) {
                        monthlyPrincipal += principalPaid;
                        fortnightlyPrincipal += principalPaid;
                        yearlyPrincipal += principalPaid;
                        totalPrincipalPaid += principalPaid;
                    }

                    // Reset monthly interest accrued
                    monthlyInterestAccrued = 0;

                    // If loan is paid off, break
                    if (loanBalance < 0.01) {
                        loanBalance = 0;
                    }
                }

                // Check for breakeven point (offset >= loan)
                if (!breakevenReached && offsetBalance >= loanBalance) {
                    breakevenReached = true;
                    breakevenDate = new Date(currentDate);
                }

                // Store daily data
                dailyData.push({
                    date: new Date(currentDate),
                    loanBalance: loanBalance,
                    offsetBalance: offsetBalance,
                    effectiveBalance: effectiveBalance,
                    dailyInterest: dailyInterest
                });

                // Month end recording
                const nextDay = new Date(currentDate);
                nextDay.setDate(nextDay.getDate() + 1);

                if (nextDay.getMonth() !== currentMonth || loanBalance <= 0.01) {
                    monthlyData.push({
                        date: new Date(currentDate),
                        loanBalance: loanBalance,
                        offsetBalance: offsetBalance,
                        interestCharged: monthlyInterest,
                        principalPaid: monthlyPrincipal
                    });
                    monthlyInterest = 0;
                    monthlyPrincipal = 0;
                    currentMonth = nextDay.getMonth();
                }

                // Fortnight recording
                fortnightCount++;
                if (fortnightCount >= 14 || loanBalance <= 0.01) {
                    fortnightlyData.push({
                        date: new Date(currentDate),
                        loanBalance: loanBalance,
                        offsetBalance: offsetBalance,
                        interestCharged: fortnightlyInterest,
                        principalPaid: fortnightlyPrincipal
                    });
                    fortnightlyInterest = 0;
                    fortnightlyPrincipal = 0;
                    fortnightCount = 0;
                }

                // Year end recording
                if (nextDay.getFullYear() !== currentYear || loanBalance <= 0.01) {
                    yearlyData.push({
                        year: currentYear,
                        loanBalance: loanBalance,
                        offsetBalance: offsetBalance,
                        interestPaid: yearlyInterest,
                        principalPaid: yearlyPrincipal,
                        cumulativeInterest: totalInterestPaid,
                        cumulativePrincipal: totalPrincipalPaid
                    });
                    yearlyInterest = 0;
                    yearlyPrincipal = 0;
                    currentYear = nextDay.getFullYear();
                }

                // Move to next day
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // Handle any remaining balance in the final month if loan is paid off
            if (dailyData.length === 0) {
                alert('Calculation error: No data generated. Please check your inputs.');
                return;
            }

            // Calculate actual time taken with offset
            const finalDate = new Date(dailyData[dailyData.length - 1].date);
            const actualMonthsTaken = calculateMonthsDifference(startDate, finalDate);

            // Calculate expected time without offset
            const expectedMonths = loanTermYears * 12;

            // Calculate time saved
            const monthsSaved = expectedMonths - actualMonthsTaken;

            // Calculate interest savings
            const interestSaved = totalInterestWithoutOffset - totalInterestPaid;

            // Calculate breakeven time
            let breakevenMonths = 0;
            let breakevenText = 'Not reached';
            if (breakevenDate) {
                breakevenMonths = calculateMonthsDifference(startDate, breakevenDate);
                breakevenText = formatTimePeriod(breakevenMonths);
            }

            // Update summary displays
            document.getElementById('totalInterest').textContent = formatCurrency(totalInterestPaid);
            document.getElementById('totalPaid').textContent = formatCurrency(loanAmount + totalInterestPaid);
            document.getElementById('interestSaved').textContent = formatCurrency(interestSaved);
            document.getElementById('timeSaved').textContent = formatTimePeriod(monthsSaved);
            document.getElementById('totalTime').textContent = formatTimePeriod(actualMonthsTaken);
            document.getElementById('emiAmount').textContent = formatCurrency(emi);
            document.getElementById('finalOffset').textContent = formatCurrency(offsetBalance);
            document.getElementById('breakevenTime').textContent = breakevenText;

            // Populate monthly table
            const monthlyTableBody = document.getElementById('monthlyTableBody');
            monthlyTableBody.innerHTML = '';
            monthlyData.forEach((data, index) => {
                const row = monthlyTableBody.insertRow();
                row.innerHTML = `
                    <td>${formatDate(data.date)}</td>
                    <td>${formatCurrency(data.loanBalance)}</td>
                    <td>${formatCurrency(data.offsetBalance)}</td>
                    <td>${formatCurrency(data.interestCharged)}</td>
                    <td>${formatCurrency(data.principalPaid)}</td>
                `;
                // Highlight year-end rows
                if (data.date.getMonth() === 11) {
                    row.classList.add('highlight-row');
                }
            });

            // Populate fortnightly table
            const fortnightlyTableBody = document.getElementById('fortnightlyTableBody');
            fortnightlyTableBody.innerHTML = '';
            fortnightlyData.forEach((data, index) => {
                const row = fortnightlyTableBody.insertRow();
                row.innerHTML = `
                    <td>${formatDate(data.date)}</td>
                    <td>${formatCurrency(data.loanBalance)}</td>
                    <td>${formatCurrency(data.offsetBalance)}</td>
                    <td>${formatCurrency(data.interestCharged)}</td>
                    <td>${formatCurrency(data.principalPaid)}</td>
                `;
            });

            // Populate yearly table
            const yearlyTableBody = document.getElementById('yearlyTableBody');
            yearlyTableBody.innerHTML = '';
            yearlyData.forEach(data => {
                const totalPaidTillNow = data.cumulativeInterest + data.cumulativePrincipal;
                const row = yearlyTableBody.insertRow();
                row.innerHTML = `
                    <td>${data.year}</td>
                    <td>${formatCurrency(data.loanBalance)}</td>
                    <td>${formatCurrency(data.offsetBalance)}</td>
                    <td>${formatCurrency(data.interestPaid)}</td>
                    <td>${formatCurrency(data.principalPaid)}</td>
                    <td><strong>${formatCurrency(totalPaidTillNow)}</strong></td>
                `;
                // Highlight breakeven years (offset >= loan) with special color
                if (data.offsetBalance >= data.loanBalance && data.loanBalance > 0) {
                    row.classList.add('breakeven-row');
                } else {
                    row.classList.add('highlight-row');
                }
            });
        }

        // Calculate on page load with default values
        window.onload = function () {
            calculate();
        };
    </script>
</body>

</html>
